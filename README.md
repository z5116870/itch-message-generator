# itch-message-generator (IMG)
This project is a C++ application that generates ITCH protocol messages and sends them via UDP to a multicast IP address.  
It’s designed for local testing or simulation of market-data–style traffic, allowing developers to generate structured “ITCH” type messages and transmit them over a network. It was made for my other project, the [market-data-feed-handler](https://github.com/z5116870/market-data-feed-handler) which aims to receive the binary stream of ITCH messages generated by this application, and parse it into a kdb table. 

---

## Background
Stock exchanges around the world, such as NASDAQ and ASX, provide real-time data on market events, including order-book updates, trades, cancellations, and other activities. This information is typically transmitted via UDP multicast feeds. The ***ITCH protocol*** is a binary message format used to encode these events. It is widely adopted by authorized groups, such as trading firms, to model and process market activity, which they then use to execute trades. It is the parsing of these ITCH messages that allow for high frequency trading (HFT) algorithms to run. These groups can subscribe to specialized market data feeds to receive live updates.

For more details on the message formats used in this application, refer to the [ASX ITCH Protocol Specification](https://github.com/z5116870/itch-message-generator/blob/main/docs/ASX_ITCH_PROTOCOL_SPEC.pdf)

---

## Overview

This repository implements a high-performance ITCH message generator in C++, intended to simulate real-time market data feeds.
It includes:
- Message generation: Trade, Order, System Event, and Cancel messages.
- Retry buffer: Handles cases where the buffer is too small for a message.
- Cache-aligned buffers: 64-byte alignment for low-latency, cache-friendly memory access.
- Sequence number handling: Monotonic increments to simulate real-world market feed sequences.

This project is part of a portfolio of low-latency trading and market data systems programming projects, alongside the [Market Data Feed Handler](https://github.com/z5116870/market-data-feed-handler)

---
## Business Value / Technical Context

This generator serves as a high-fidelity simulation of exchange ITCH feeds. It allows:
- Trading system engineers to test order book handling without connecting to a live exchange.
- Latency-sensitive system validation, by stressing buffer handling, message serialization, and retry logic.
- Quantitative research and development, by providing realistic market message sequences for backtesting.

Key technical design choices:
- Batched sending of messages prior to sending over UDP multicast (1472 bytes max, maximizing wire usage)
- Retry buffers to guarantee no messages are lost if the primary buffer is insufficient.
- Zero dynamic allocations in hot paths for consistent low-latency performance.
- End-to-end serialization checks using GoogleTest for correctness (using GIVEN-WHEN-THEN structure)

---
## Data Flow Diagram
```
   +--------------------+       +----------------+       +----------------------+
   | ITCH Message        |       | Retry Buffer   |       | Market Data Feed     |
   | Generator           |------>| (if buffer    |------>| Handler             |
   | (generateMessage)   |       | overflow)     |       | (receives messages) |
   +--------------------+       +----------------+       +----------------------+
```
- Messages are generated by the generator, randomly indexing a function pointer array (randomly generates a serialized ITCH message)
- Each message is written to a buffer.
- If the buffer overflows 1472 bytes, the UDP payload is instead sent and message overflowing is stored in the retry buffer
- The retry buffer is then copied to the start of the next UDP payload, and the process repeats.

## Getting Started

### Prerequisites

- A C++ compiler supporting at least C++20 (e.g., GCC, Clang, or MSVC)
- A system with multicast support
- CMake or other build system

### Building & Usage

Example command-line build:

```bash
cd build
cmake ..
make -j
sudo ./bin/itch_gen 239.1.1.1 30001
```
The program will start generating ITCH messages and broadcasting them to the provided multicast address and port.

### 1. Running Tests
Option A: Run the test binary directly
```
./bin/itch_unit_tests
```

To filter tests:
```
./bin/mdfh_unit_tests --gtest_filter=><test-file-name>.*
```

Option B: Run tests via CTest (verbose)
```
ctest
```

Very verbose mode:
```
ctest -VV
```

### 2. Summary

- Run `sudo ./bin/mdfh <MULTICAST_IP> <PORT>`
- Run `cmake ..` and `make -j` inside build/.
- Binaries appear in `build/bin/.`
- Run tests using `ctest -V` or `./bin/mdfh_unit_tests`
- Run benchmarks using `./bin/benchmark_multithreading`.
---
## Integration with Market Data Feed Handler

This generator is intended to feed the Market Data Feed Handler project.

Usage scenario: run the generator binary to produce ITCH messages and feed them into the handler for latency testing or system validation.
Inputs: the generator requires:
- IP address of the receiver (e.g., your handler).
- Port to send messages.

Binary location: after building, the executable is located in build/bin/.

Example:
```
sudo ./build/bin/itch_gen 127.0.0.1 9999
```

This will send a continuous stream of ITCH messages to the specified IP and port.

Then, similarly, run MDFH:
```
sudo ./build/bin/mdfh 127.0.0.1 9999
```
---
## Design Notes
- Serialization: Multi-byte integers are converted to network byte order (htonl) before writing.
- Retry Buffer: If a message cannot fit into the remaining buffer, it is stored in a dedicated retry buffer.
- Memory alignment: Buffers are aligned to 64 bytes to avoid false sharing and optimize cache usage.
- Testing philosophy: All tests follow GIVEN-WHEN-THEN structure for clarity and maintainability.

### Message Generation
messages.cpp and messages.h define the ITCH message formats and serialization logic.
Each message corresponds to a protocol type, with fields like order ID, timestamp, and price.
main.cpp orchestrates message creation and sending.

### UDP / Multicast Settings
Ensure your OS/network allows sending to multicast groups. Use a receiver listening on the same multicast IP/port. Adjust TTL or loopback options as needed

---
## Future work
Extension of the IMG is planned to support a rerequest server running on a separate thread to allow clients running the MDFH to request lost messages. Requires storing window of all messages. 

---
## Structure & Code Overview
```
itch-message-generator/
├── build/          # Build directory (binaries in bin/)
├── docs/           # All docs and diagrams
├── include/        # Public headers (including inline functions)
├── screenshots/    # Example outputs, logs, benchmark results or diagrams
├── src/            # Source code (parsing logic, main, etc.)
├── test/           # Tests and sample data for parsing / packet handling
├── .gitignore
├── CMakeLists.txt
├── LICENSE
└── README.md
```
